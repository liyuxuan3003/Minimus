\ProvidesPackage{minimus-reference}

% -------------------------------- %
% Load package <etoolbox> : Toolbox for class and package
\RequirePackage{etoolbox}
% Load package <xparse> : New way to define command and environment
\RequirePackage{xparse}

% -------------------------------- %
% Load Package <hyperref> : Hyperlinks for ref/cite/toc
% hidelinks -> Hide box of hyperlinks
\RequirePackage[hidelinks]{hyperref}

% -------------------------------- %
% Load Package <aliascnt> : Create alian for counter
\RequirePackage{aliascnt}
% aliascnt must be loaded before cleveref
% aliascnt's \newaliascnt must be used after cleveref has been loaded

% -------------------------------- %
% Load Package <cleveref> : Clever reference with type
\RequirePackage{cleveref}
% \cref -> lowercase ref (section 1.1)
% \Cref -> uppercase ref (Section 1.1)
% For zh-cn, just set lowercase and uppercase ref format to the same.

% \crefformat           -> format for single ref
% \crefformat{type}{format}
% Example: Figure 1.1
% |- format
%   |- #1       -> counter
%   |- #2/#3    -> hyperref range

% \crefrangeformat      -> format for range ref
% \crefrangeformat{type}{format}
% Example: Figure 1.1-1.4
% |- format
%   |- #1       -> counter of first
%   |- #2       -> counter of last
%   |- #3/#4    -> hyperref range of first
%   |- #5/#6    -> hyperref range of last

% \crefmultiformat      -> format for multi single ref
% \crefmultiformat{type}{first}{second}{middle}{last}
% Example: Figure 1.1, 1.4, 2.8 and 2.9
% |- first   -> Always, format for first ref
% |- second  -> If only 2, format for second ref
% |- middle  -> If more than 2, format for every ref in middle
% |- last    -> If more than 2, format for last ref
%   |- #1       -> counter
%   |- #2       -> hyperref range

% \crefrangemultiformat -> format for multi range ref
% \crefrangemultiformat{type}{first}{second}{middle}{last}
% Example: Figure 1.1-1.4, 1.5-1.7, 2.1-2.3 and 2.8-2.9
% |- first   -> Always, format for first range
% |- second  -> If only 2, format for second range
% |- middle  -> If more than 2, format for every range in middle
% |- last    -> If more than 2, format for last range
%   |- #1       -> counter of first
%   |- #2       -> counter of last
%   |- #3/#4    -> hyperref range of first
%   |- #5/#6    -> hyperref range of last

% Sometimes, \crefmultiformat and \crefrangemultiformat have to work together
% It is ok as long as both format are defined
% Example: Figure 1.1-1.4, 1.5, 2.1-2.3 and 2.9

% -------------------------------- %
% Part
% ----------------
\crefformat{part}
{\CJKsetecglue{}#2{第{#1}部分}#3}
\Crefformat{part}
{\CJKsetecglue{}#2{第{#1}部分}#3}
% ----------------
\crefrangeformat{part}
{\CJKsetecglue{}#3{第{#1}部分}#4至#5{第{#2}部分}#6}
\Crefrangeformat{part}
{\CJKsetecglue{}#3{第{#1}部分}#4至#5{第{#2}部分}#6}
% ----------------
\crefmultiformat{part}
{\CJKsetecglue{}#2{第{#1}部分}#3}
{\CJKsetecglue{}和#2{第{#1}部分}#3}
{\CJKsetecglue{}、#2{第{#1}部分}#3}
{\CJKsetecglue{}、#2{第{#1}部分}#3}
\Crefmultiformat{part}
{\CJKsetecglue{}#2{第{#1}部分}#3}
{\CJKsetecglue{}和#2{第{#1}部分}#3}
{\CJKsetecglue{}、#2{第{#1}部分}#3}
{\CJKsetecglue{}、#2{第{#1}部分}#3}
% ----------------
\crefrangemultiformat{part}
{\CJKsetecglue{}#3{第{#1}部分}#4至#5{第{#2}部分}#6}
{\CJKsetecglue{}和#3{第{#1}部分}#4至#5{第{#2}部分}#6}
{\CJKsetecglue{}、#3{第{#1}部分}#4至#5{第{#2}部分}#6}
{\CJKsetecglue{}、#3{第{#1}部分}#4至#5{第{#2}部分}#6}
\Crefrangemultiformat{part}
{\CJKsetecglue{}#3{第{#1}部分}#4至#5{第{#2}部分}#6}
{\CJKsetecglue{}和#3{第{#1}部分}#4至#5{第{#2}部分}#6}
{\CJKsetecglue{}、#3{第{#1}部分}#4至#5{第{#2}部分}#6}
{\CJKsetecglue{}、#3{第{#1}部分}#4至#5{第{#2}部分}#6}

% -------------------------------- %
% Chapter
% ----------------
\crefformat{chapter}
{\CJKsetecglue{}#2{第{#1}章}#3}
\Crefformat{chapter}
{\CJKsetecglue{}#2{第{#1}章}#3}
% ----------------
\crefrangeformat{chapter}
{\CJKsetecglue{}#3{第{#1}章}#4至#5{第{#2}章}#6}
\Crefrangeformat{chapter}
{\CJKsetecglue{}#3{第{#1}章}#4至#5{第{#2}章}#6}
% ----------------
\crefmultiformat{chapter}
{\CJKsetecglue{}#2{第{#1}章}#3}
{\CJKsetecglue{}和#2{第{#1}章}#3}
{\CJKsetecglue{}、#2{第{#1}章}#3}
{\CJKsetecglue{}、#2{第{#1}章}#3}
\Crefmultiformat{chapter}
{\CJKsetecglue{}#2{第{#1}章}#3}
{\CJKsetecglue{}和#2{第{#1}章}#3}
{\CJKsetecglue{}、#2{第{#1}章}#3}
{\CJKsetecglue{}、#2{第{#1}章}#3}
% ----------------
\crefrangemultiformat{chapter}
{\CJKsetecglue{}#3{第{#1}章}#4至#5{第{#2}章}#6}
{\CJKsetecglue{}和#3{第{#1}章}#4至#5{第{#2}章}#6}
{\CJKsetecglue{}、#3{第{#1}章}#4至#5{第{#2}章}#6}
{\CJKsetecglue{}、#3{第{#1}章}#4至#5{第{#2}章}#6}
\Crefrangemultiformat{chapter}
{\CJKsetecglue{}#3{第{#1}章}#4至#5{第{#2}章}#6}
{\CJKsetecglue{}和#3{第{#1}章}#4至#5{第{#2}章}#6}
{\CJKsetecglue{}、#3{第{#1}章}#4至#5{第{#2}章}#6}
{\CJKsetecglue{}、#3{第{#1}章}#4至#5{第{#2}章}#6}

% -------------------------------- %
% Section
% ----------------
\crefformat{section}
{\CJKsetecglue{}#2{第{#1}节}#3}
\Crefformat{section}
{\CJKsetecglue{}#2{第{#1}节}#3}
% ----------------
\crefrangeformat{section}
{\CJKsetecglue{}#3{第{#1}}#4--#5{{#2}节}#6}
\Crefrangeformat{section}
{\CJKsetecglue{}#3{第{#1}}#4--#5{{#2}节}#6}
% ----------------
\crefmultiformat{section}
{\CJKsetecglue{}#2{第{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}节}#3}
{\CJKsetecglue{},\,#2{{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}节}#3}
\Crefmultiformat{section}
{\CJKsetecglue{}#2{第{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}节}#3}
{\CJKsetecglue{},\,#2{{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}节}#3}
% ----------------
\crefrangemultiformat{section}
{\CJKsetecglue{}#3{第{#1}}#4--#5{{#2}节}#6}
{\CJKsetecglue{},\,#3{第{#1}}#4--#5{{#2}节}#6}
{\CJKsetecglue{},\,#3{第{#1}}#4--#5{{#2}节}#6}
{\CJKsetecglue{},\,#3{第{#1}}#4--#5{{#2}节}#6}
\Crefrangemultiformat{section}
{\CJKsetecglue{}#3{第{#1}}#4--#5{{#2}节}#6}
{\CJKsetecglue{},\,#3{第{#1}}#4--#5{{#2}节}#6}
{\CJKsetecglue{},\,#3{第{#1}}#4--#5{{#2}节}#6}
{\CJKsetecglue{},\,#3{第{#1}}#4--#5{{#2}节}#6}

% -------------------------------- %
% Subsection
% ----------------
\crefformat{subsection}
{\CJKsetecglue{}#2{第{#1}小节}#3}
\Crefformat{subsection}
{\CJKsetecglue{}#2{第{#1}小节}#3}
% ----------------
\crefrangeformat{subsection}
{\CJKsetecglue{}#3{第{#1}}#4--#5{{#2}小节}#6}
\Crefrangeformat{subsection}
{\CJKsetecglue{}#3{第{#1}}#4--#5{{#2}小节}#6}
% ----------------
\crefmultiformat{subsection}
{\CJKsetecglue{}#2{第{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}小节}#3}
{\CJKsetecglue{},\,#2{{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}小节}#3}
\Crefmultiformat{subsection}
{\CJKsetecglue{}#2{第{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}小节}#3}
{\CJKsetecglue{},\,#2{{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}小节}#3}
% ----------------
\crefrangemultiformat{subsection}
{\CJKsetecglue{}#3{第{#1}}#4--#5{{#2}小节}#6}
{\CJKsetecglue{},\,#3{第{#1}}#4--#5{{#2}小节}#6}
{\CJKsetecglue{},\,#3{第{#1}}#4--#5{{#2}小节}#6}
{\CJKsetecglue{},\,#3{第{#1}}#4--#5{{#2}小节}#6}
\Crefrangemultiformat{subsection}
{\CJKsetecglue{}#3{第{#1}}#4--#5{{#2}小节}#6}
{\CJKsetecglue{},\,#3{第{#1}}#4--#5{{#2}小节}#6}
{\CJKsetecglue{},\,#3{第{#1}}#4--#5{{#2}小节}#6}
{\CJKsetecglue{},\,#3{第{#1}}#4--#5{{#2}小节}#6}

% -------------------------------- %
% Subsubsection
% ----------------
\crefformat{subsubsection}
{\CJKsetecglue{}#2{第{#1}小节}#3}
\Crefformat{subsubsection}
{\CJKsetecglue{}#2{第{#1}小节}#3}
% ----------------
\crefrangeformat{subsubsection}
{\CJKsetecglue{}#3{第{#1}}#4--#5{{#2}小节}#6}
\Crefrangeformat{subsubsection}
{\CJKsetecglue{}#3{第{#1}}#4--#5{{#2}小节}#6}
% ----------------
\crefmultiformat{subsubsection}
{\CJKsetecglue{}#2{第{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}小节}#3}
{\CJKsetecglue{},\,#2{{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}小节}#3}
\Crefmultiformat{subsubsection}
{\CJKsetecglue{}#2{第{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}小节}#3}
{\CJKsetecglue{},\,#2{{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}小节}#3}
% ----------------
\crefrangemultiformat{subsubsection}
{\CJKsetecglue{}#3{第{#1}}#4--#5{{#2}小节}#6}
{\CJKsetecglue{},\,#3{第{#1}}#4--#5{{#2}小节}#6}
{\CJKsetecglue{},\,#3{第{#1}}#4--#5{{#2}小节}#6}
{\CJKsetecglue{},\,#3{第{#1}}#4--#5{{#2}小节}#6}
\Crefrangemultiformat{subsubsection}
{\CJKsetecglue{}#3{第{#1}}#4--#5{{#2}小节}#6}
{\CJKsetecglue{},\,#3{第{#1}}#4--#5{{#2}小节}#6}
{\CJKsetecglue{},\,#3{第{#1}}#4--#5{{#2}小节}#6}
{\CJKsetecglue{},\,#3{第{#1}}#4--#5{{#2}小节}#6}

% -------------------------------- %
% Appendix
% ----------------
\crefformat{appendix}
{\CJKsetecglue{}#2{附录{#1}}#3}
\Crefformat{appendix}
{\CJKsetecglue{}#2{附录{#1}}#3}
% ----------------
\crefrangeformat{appendix}
{\CJKsetecglue{}#3{附录{#1}}#4--#5{{#2}}#6}
\Crefrangeformat{appendix}
{\CJKsetecglue{}#3{附录{#1}}#4--#5{{#2}}#6}
% ----------------
\crefmultiformat{appendix}
{\CJKsetecglue{}#2{附录{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}}#3}
\Crefmultiformat{appendix}
{\CJKsetecglue{}#2{附录{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}}#3}
% ----------------
\crefrangemultiformat{appendix}
{\CJKsetecglue{}#3{附录{#1}}#4--#5{{#2}}#6}
{\CJKsetecglue{},\,#3{附录{#1}}#4--#5{{#2}}#6}
{\CJKsetecglue{},\,#3{附录{#1}}#4--#5{{#2}}#6}
{\CJKsetecglue{},\,#3{附录{#1}}#4--#5{{#2}}#6}
\Crefrangemultiformat{appendix}
{\CJKsetecglue{}#3{附录{#1}}#4--#5{{#2}}#6}
{\CJKsetecglue{},\,#3{附录{#1}}#4--#5{{#2}}#6}
{\CJKsetecglue{},\,#3{附录{#1}}#4--#5{{#2}}#6}
{\CJKsetecglue{},\,#3{附录{#1}}#4--#5{{#2}}#6}

% -------------------------------- %
% Equation
% ----------------
\crefformat{equation}
{\CJKsetecglue{}#2{式({#1})}#3}
\Crefformat{equation}
{\CJKsetecglue{}#2{式({#1})}#3}
% ----------------
\crefrangeformat{equation}
{\CJKsetecglue{}#3{式({#1}}#4--#5{{#2})}#6}
\Crefrangeformat{equation}
{\CJKsetecglue{}#3{式({#1}}#4--#5{{#2})}#6}
% ----------------
\crefmultiformat{equation}
{\CJKsetecglue{}#2{式({#1}}#3}
{\CJKsetecglue{},\,#2{{#1})}#3}
{\CJKsetecglue{},\,#2{{#1}}#3}
{\CJKsetecglue{},\,#2{{#1})}#3}
\Crefmultiformat{equation}
{\CJKsetecglue{}#2{式({#1}}#3}
{\CJKsetecglue{},\,#2{{#1})}#3}
{\CJKsetecglue{},\,#2{{#1}}#3}
{\CJKsetecglue{},\,#2{{#1})}#3}
% ----------------
\crefrangemultiformat{equation}
{\CJKsetecglue{}#3{式({#1}}#4--#5{{#2})}#6}
{\CJKsetecglue{},\,#3{式({#1}}#4--#5{{#2})}#6}
{\CJKsetecglue{},\,#3{式({#1}}#4--#5{{#2})}#6}
{\CJKsetecglue{},\,#3{式({#1}}#4--#5{{#2})}#6}
\Crefrangemultiformat{equation}
{\CJKsetecglue{}#3{式({#1}}#4--#5{{#2})}#6}
{\CJKsetecglue{},\,#3{式({#1}}#4--#5{{#2})}#6}
{\CJKsetecglue{},\,#3{式({#1}}#4--#5{{#2})}#6}
{\CJKsetecglue{},\,#3{式({#1}}#4--#5{{#2})}#6}

% -------------------------------- %
% Table
% ----------------
\crefformat{table}
{\CJKsetecglue{}#2{表{#1}}#3}
\Crefformat{table}
{\CJKsetecglue{}#2{表{#1}}#3}
% ----------------
\crefrangeformat{table}
{\CJKsetecglue{}#3{表{#1}}#4--#5{{#2}}#6}
\Crefrangeformat{table}
{\CJKsetecglue{}#3{表{#1}}#4--#5{{#2}}#6}
% ----------------
\crefmultiformat{table}
{\CJKsetecglue{}#2{表{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}}#3}
\Crefmultiformat{table}
{\CJKsetecglue{}#2{表{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}}#3}
% ----------------
\crefrangemultiformat{table}
{\CJKsetecglue{}#3{表{#1}}#4--#5{{#2}}#6}
{\CJKsetecglue{},\,#3{表{#1}}#4--#5{{#2}}#6}
{\CJKsetecglue{},\,#3{表{#1}}#4--#5{{#2}}#6}
{\CJKsetecglue{},\,#3{表{#1}}#4--#5{{#2}}#6}
\Crefrangemultiformat{table}
{\CJKsetecglue{}#3{表{#1}}#4--#5{{#2}}#6}
{\CJKsetecglue{},\,#3{表{#1}}#4--#5{{#2}}#6}
{\CJKsetecglue{},\,#3{表{#1}}#4--#5{{#2}}#6}
{\CJKsetecglue{},\,#3{表{#1}}#4--#5{{#2}}#6}

% -------------------------------- %
% Figure
% ----------------
\crefformat{figure}
{\CJKsetecglue{}#2{图{#1}}#3}
\Crefformat{figure}
{\CJKsetecglue{}#2{图{#1}}#3}
% ----------------
\crefrangeformat{figure}
{\CJKsetecglue{}#3{图{#1}}#4--#5{{#2}}#6}
\Crefrangeformat{figure}
{\CJKsetecglue{}#3{图{#1}}#4--#5{{#2}}#6}
% ----------------
\crefmultiformat{figure}
{\CJKsetecglue{}#2{图{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}}#3}
\Crefmultiformat{figure}
{\CJKsetecglue{}#2{图{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}}#3}
{\CJKsetecglue{},\,#2{{#1}}#3}
% ----------------
\crefrangemultiformat{figure}
{\CJKsetecglue{}#3{图{#1}}#4--#5{{#2}}#6}
{\CJKsetecglue{},\,#3{{#1}}#4--#5{{#2}}#6}
{\CJKsetecglue{},\,#3{{#1}}#4--#5{{#2}}#6}
{\CJKsetecglue{},\,#3{{#1}}#4--#5{{#2}}#6}
\Crefrangemultiformat{figure}
{\CJKsetecglue{}#3{图{#1}}#4--#5{{#2}}#6}
{\CJKsetecglue{},\,#3{{#1}}#4--#5{{#2}}#6}
{\CJKsetecglue{},\,#3{{#1}}#4--#5{{#2}}#6}
{\CJKsetecglue{},\,#3{{#1}}#4--#5{{#2}}#6}

% -------------------------------- %
% Define format between different type of reference
% range
\NewDocumentCommand{\crefrangeconjunction}{}{至}
% multi-single second
\NewDocumentCommand{\crefpairconjunction}{}{和}
% multi-single middle
\NewDocumentCommand{\crefmiddleconjunction}{}{、}
% multi-single last
\NewDocumentCommand{\creflastconjunction}{}{、}
% multi-range second
\NewDocumentCommand{\crefpairgroupconjunction}{}{和}
% multi-range middle
\NewDocumentCommand{\crefmiddlegroupconjunction}{}{、}
% multi-range last
\NewDocumentCommand{\creflastgroupconjunction}{}{、}
